<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì„±ê²½ í€´ì¦ˆ</title>
  <style>
    :root{
      --bg:#0b1020;--card:#121a34;--ink:#e8eeff;--muted:#9fb0ff;--accent:#7aa2ff;--good:#3ad39f;--bad:#ff6b6b;--warn:#ffb84d;
      --br:18px;--gap:14px;--shadow:0 10px 30px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 800px at 25% -10%,#1e2a56 0%,#0b1020 50%),var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
    .wrap{max-width:960px;margin:24px auto;padding:16px;position:relative}
    header{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:16px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand .logo{width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,#6fa3ff, #9f78ff);display:grid;place-items:center;font-weight:800;color:white;box-shadow:var(--shadow)}
    .card{background:var(--card);border-radius:var(--br);box-shadow:var(--shadow);padding:20px}
    .center{display:grid;place-items:center;min-height:60vh}
    .stack{display:flex;flex-direction:column;gap:var(--gap)}
    input[type="text"]{width:100%;padding:14px 16px;border-radius:12px;border:1px solid #233066;background:#0f1731;color:var(--ink);outline:none}
    button{border:0;padding:12px 16px;border-radius:12px;background:linear-gradient(135deg,#6fa3ff,#9f78ff);color:white;font-weight:700;cursor:pointer}
    button.ghost{background:transparent;border:1px solid #2e3a70}
    .muted{color:var(--muted);font-size:.95rem}
    .row{display:flex;gap:10px;align-items:center}
    .row.wrap{flex-wrap:wrap}
    .grow{flex:1}
    .score{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .badge{padding:6px 10px;border-radius:999px;background:#0f1731;border:1px solid #273571}
    .progress{width:100%;height:10px;background:#0f1731;border-radius:999px;overflow:hidden;border:1px solid #26336b}
    .progress>div{height:100%;background:linear-gradient(90deg,#ffb84d,#ff6b6b);width:100%}
    .verse{font-size:1.25rem;line-height:1.9}
    .verse .blank{display:inline-block;min-width:8ch;padding:.15rem .35rem;border-bottom:2px dashed #5a73d6;border-radius:6px;background:rgba(122,162,255,.06)}
    .result{padding:12px 14px;border-radius:12px;background:#0f1731;border:1px solid #243267}
    .result.good{border-color:#24674d;background:#0f1d19}
    .result.bad{border-color:#673024;background:#1d1010}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #243267;text-align:left}
    #adminBtn{position:fixed;bottom:10px;right:10px;background:none;border:none;font-size:24px;cursor:pointer;z-index:5;}
    .card, button{position:relative;z-index:1;}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">BQ</div>
        <div>
          <div style="font-weight:800">ì„±ê²½ í€´ì¦ˆ</div>
          <div class="muted">ë¹ˆì¹¸ ì±„ìš°ê¸° Â· 20ì´ˆ íƒ€ì´ë¨¸ Â· ì •ë‹µ +30ì </div>
        </div>
      </div>
      <div class="row score" id="scoreBoard" style="display:none">
        <div class="badge"><span id="playerBadge">ê²ŒìŠ¤íŠ¸</span></div>
        <div class="badge">ì ìˆ˜: <b id="score">0</b> / 1000</div>
        <div class="badge warn">ë‚¨ì€ì‹œê°„: <b id="time">20</b>s</div>
        <div class="badge">ë¬¸í•­: <b id="qIndex">0</b></div>
        <div class="badge">ê¸°íšŒ: <b id="lives">10</b></div>
      </div>
    </header>

    <!-- ì‹œì‘ í™”ë©´ -->
    <section id="start" class="card center">
      <div class="stack" style="max-width:520px">
        <h1>ì‹œì‘í•˜ê¸°</h1>
        <input id="nameInput" type="text" placeholder="ì´ë¦„ (ì˜ˆ: í™ê¸¸ë™)" />
        <div class="row">
          <button id="startBtn" type="button" class="grow">ì‹œì‘í•˜ê¸°</button>
          <button id="rankBtn" type="button" class="ghost">ë­í‚¹ ë³´ê¸°</button>
          <button id="howBtn" type="button" class="ghost">ê·œì¹™ ë³´ê¸°</button>
        </div>
      </div>
    </section>

    <!-- í€´ì¦ˆ í™”ë©´ -->
    <section id="quiz" class="card" style="display:none">
      <div class="stack">
        <div class="progress"><div id="bar"></div></div>
        <div class="muted" id="ref"></div>
        <div class="verse" id="verse"></div>
        <div class="row wrap">
          <input id="answer" class="grow" type="text" placeholder="ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ë‹¨ì–´" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" inputmode="text" />
          <button id="submitBtn" type="button">ì œì¶œ</button>
          <button id="passBtn" type="button" class="ghost">íŒ¨ìŠ¤</button>
        </div>
        <div id="feedback" class="result" style="display:none"></div>
      </div>
    </section>

    <!-- ë­í‚¹ í™”ë©´ -->
    <section id="leaderboard" class="card" style="display:none">
      <div class="stack">
        <h2>ë­í‚¹</h2>
        <div class="row">
          <button id="backStart" type="button" class="ghost">ì‹œì‘ í™”ë©´</button>
        </div>
        <table>
          <thead>
            <tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ì ìˆ˜</th><th>ì™„ë£Œ ì‹œê°„</th></tr>
          </thead>
          <tbody id="lbBody"></tbody>
        </table>
      </div>
    </section>

    <!-- ìš´ì˜ì ëª¨ë“œ ë²„íŠ¼ (êµ¬ì„ í­ê·„) -->
    <button id="adminBtn" type="button" title="ìš´ì˜ì">ğŸ§</button>
  </div>

  <!-- Firebase SDK: ë¨¼ì € ë¡œë“œ -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyAnit284Kj3Rv3hXphywKMW-S1jg7TcV_8",
  authDomain: "biblestory-d636c.firebaseapp.com",
  projectId: "biblestory-d636c",
  storageBucket: "biblestory-d636c.appspot.com",
  messagingSenderId: "823812059117",
  appId: "1:823812059117:web:777a2266b354945780c1e4",
  measurementId: "G-5Z4KX2XPP8"
};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const recordsCol = db.collection('records');

    let QUESTIONS = [
   {book:"ì¶œì• êµ½ê¸°",ref:"20:12",before:"ë„¤ ë¶€ëª¨ë¥¼",blank:"ê³µê²½í•˜ë¼",after:"",answers:["ê³µê²½í•˜ë¼","ê³µê²½"]},
  {book:"ì—ë² ì†Œì„œ",ref:"6:1",before:"ìë…€ë“¤ì•„ ë„ˆí¬",blank:"ë¶€ëª¨ì—ê²Œ ìˆœì¢…í•˜ë¼",after:"",answers:["ë¶€ëª¨ì—ê²Œ ìˆœì¢…í•˜ë¼","ë¶€ëª¨"]},
  {book:"ì‹œí¸",ref:"119:105",before:"ì£¼ì˜ ë§ì”€ì€ ë‚´ ë°œì—",blank:"ë“±ì´ìš”",after:" ë‚´ ê¸¸ì— ë¹›ì´ë‹ˆì´ë‹¤",answers:["ë“±ì´ìš”","ë“±"]},
  {book:"ë§ˆê°€ë³µìŒ",ref:"10:14",before:"ì–´ë¦°ì•„ì´ë“¤ì´ ë‚´ê²Œ ì˜¤ëŠ” ê²ƒì„",blank:"ìš©ë‚©í•˜ë¼",after:"",answers:["ìš©ë‚©í•˜ë¼","í—ˆë½í•˜ë¼"]},
  {book:"ìš”í•œì¼ì„œ",ref:"4:19",before:"ìš°ë¦¬ê°€ ì‚¬ë‘í•¨ì€ ê·¸ê°€ ë¨¼ì € ìš°ë¦¬ë¥¼",blank:"ì‚¬ë‘í•˜ì…¨ìŒì´ë¼",after:"",answers:["ì‚¬ë‘í•˜ì…¨ìŒì´ë¼","ì‚¬ë‘í•˜ì…¨ë‹¤"]},
  {book:"ë¹Œë¦½ë³´ì„œ",ref:"4:4",before:"ì£¼ ì•ˆì—ì„œ í•­ìƒ",blank:"ê¸°ë»í•˜ë¼",after:"",answers:["ê¸°ë»í•˜ë¼","ê¸°ë»"]},
  {book:"ì ì–¸",ref:"3:5",before:"ë„ˆëŠ” ë§ˆìŒì„ ë‹¤í•˜ì—¬ ì—¬í˜¸ì™€ë¥¼",blank:"ì˜ë¢°í•˜ê³ ",after:"",answers:["ì˜ë¢°í•˜ê³ ","ì‹ ë¢°í•˜ê³ "]},
  {book:"ì ì–¸",ref:"22:6",before:"ë§ˆë•…íˆ í–‰í•  ê¸¸ì„",blank:"ì•„ì´ì—ê²Œ ê°€ë¥´ì¹˜ë¼",after:"",answers:["ì•„ì´ì—ê²Œ ê°€ë¥´ì¹˜ë¼","ì•„ì´"]},
  {book:"ì‹œí¸",ref:"150:6",before:"í˜¸í¡ì´ ìˆëŠ” ìë§ˆë‹¤",blank:"ì—¬í˜¸ì™€ë¥¼ ì°¬ì–‘í• ì§€ì–´ë‹¤",after:"",answers:["ì—¬í˜¸ì™€ë¥¼ ì°¬ì–‘í• ì§€ì–´ë‹¤","ì°¬ì–‘í• ì§€ì–´ë‹¤"]},
  {book:"ìš”í•œë³µìŒ",ref:"14:6",before:"ì˜ˆìˆ˜ê»˜ì„œ ì´ë¥´ì‹œë˜ ë‚´ê°€ ê³§ ê¸¸ì´ìš”",blank:"ì§„ë¦¬ìš” ìƒëª…ì´ë‹ˆ",after:"",answers:["ì§„ë¦¬ìš” ìƒëª…ì´ë‹ˆ","ì§„ë¦¬ìš” ìƒëª…"]},
  {book:"ì°½ì„¸ê¸°",ref:"1:1",before:"íƒœì´ˆì— í•˜ë‚˜ë‹˜ì´ ì²œì§€ë¥¼",blank:"ì°½ì¡°í•˜ì‹œë‹ˆë¼",after:"",answers:["ì°½ì¡°í•˜ì‹œë‹ˆë¼","ì°½ì¡°"]},
  {book:"ì‹œí¸",ref:"121:2",before:"ë‚˜ì˜ ë„ì›€ì´ ì²œì§€ë¥¼ ì§€ìœ¼ì‹ ",blank:"ì—¬í˜¸ì™€ì—ê²Œì„œë¡œë‹¤",after:"",answers:["ì—¬í˜¸ì™€ì—ê²Œì„œë¡œë‹¤","ì—¬í˜¸ì™€"]},
  {book:"ë§ˆíƒœë³µìŒ",ref:"7:7",before:"êµ¬í•˜ë¼ ê·¸ëŸ¬ë©´ ë„ˆí¬ì—ê²Œ",blank:"ì£¼ì‹¤ ê²ƒì´ìš”",after:"",answers:["ì£¼ì‹¤ ê²ƒì´ìš”","ì£¼ì‹ ë‹¤"]},
  {book:"ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ",ref:"5:17",before:"ì‰¬ì§€ ë§ê³ ",blank:"ê¸°ë„í•˜ë¼",after:"",answers:["ê¸°ë„í•˜ë¼","ê¸°ë„"]},
  {book:"ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ",ref:"5:18",before:"ë²”ì‚¬ì—",blank:"ê°ì‚¬í•˜ë¼",after:"",answers:["ê°ì‚¬í•˜ë¼","ê°ì‚¬"]},
  {book:"ìš”í•œê³„ì‹œë¡",ref:"22:20",before:"ì£¼ ì˜ˆìˆ˜ì—¬",blank:"ì˜¤ì‹œì˜µì†Œì„œ",after:"",answers:["ì˜¤ì‹œì˜µì†Œì„œ","ì˜¤ì‹œì˜µì†Œì„œ ì•„ë©˜"]}
];
QUESTIONS.push(
  // --- 1~20 ---
  {book:"ì°½ì„¸ê¸°",ref:"1:1",before:"íƒœì´ˆì—",blank:"í•˜ë‚˜ë‹˜",after:"ì´ ì²œì§€ë¥¼ ì°½ì¡°í•˜ì‹œë‹ˆë¼",answers:["í•˜ë‚˜ë‹˜"]},
  {book:"ì‹œí¸",ref:"23:1",before:"ì—¬í˜¸ì™€ëŠ” ë‚˜ì˜",blank:"ëª©ì",after:"ì‹œë‹ˆ ë‚´ê°€ ë¶€ì¡±í•¨ì´ ì—†ìœ¼ë¦¬ë¡œë‹¤",answers:["ëª©ì"]},
  {book:"ìš”í•œë³µìŒ",ref:"14:6",before:"ì˜ˆìˆ˜ê»˜ì„œ ì´ë¥´ì‹œë˜ ë‚´ê°€ ê³§ ê¸¸ì´ìš” ì§„ë¦¬ìš”",blank:"ìƒëª…",after:"ì´ë‹ˆ",answers:["ìƒëª…"]},
  {book:"ë§ˆíƒœë³µìŒ",ref:"5:9",before:"í™”í‰í•˜ê²Œ í•˜ëŠ” ìëŠ” í•˜ë‚˜ë‹˜ì˜",blank:"ì•„ë“¤",after:"ì´ë¼ ì¼ì»¬ìŒì„ ë°›ì„ ê²ƒì´ìš”",answers:["ì•„ë“¤"]},
  {book:"ì ì–¸",ref:"1:7",before:"ì—¬í˜¸ì™€ë¥¼ ê²½ì™¸í•˜ëŠ” ê²ƒì´",blank:"ì§€ì‹",after:"ì˜ ê·¼ë³¸ì´ê±°ëŠ˜",answers:["ì§€ì‹"]},
  {book:"ì´ì‚¬ì•¼",ref:"9:6",before:"ì´ëŠ” í•œ ì•„ê¸°ê°€ ìš°ë¦¬ì—ê²Œ ë‚¬ê³  í•œ",blank:"ì•„ë“¤",after:"ì„ ìš°ë¦¬ì—ê²Œ ì£¼ì‹  ë°” ë˜ì—ˆëŠ”ë°",answers:["ì•„ë“¤"]},
  {book:"ìš”í•œì¼ì„œ",ref:"4:8",before:"ì‚¬ë‘í•˜ì§€ ì•„ë‹ˆí•˜ëŠ” ìëŠ”",blank:"í•˜ë‚˜ë‹˜",after:"ì„ ì•Œì§€ ëª»í•˜ë‚˜ë‹ˆ",answers:["í•˜ë‚˜ë‹˜"]},
  {book:"ë§ˆíƒœë³µìŒ",ref:"6:11",before:"ì˜¤ëŠ˜ ìš°ë¦¬ì—ê²Œ ì¼ìš©í• ",blank:"ì–‘ì‹",after:"ì„ ì£¼ì˜µì‹œê³ ",answers:["ì–‘ì‹"]},
  {book:"ì¶œì• êµ½ê¸°",ref:"20:16",before:"ë„ˆëŠ” ë„¤ ì´ì›ƒì— ëŒ€í•˜ì—¬",blank:"ê±°ì§“",after:"ì¦ê±°í•˜ì§€ ë§ë¼",answers:["ê±°ì§“"]},
  {book:"ë§ˆíƒœë³µìŒ",ref:"22:39",before:"ë„¤",blank:"ì´ì›ƒ",after:"ì„ ë„¤ ìì‹ ê³¼ ê°™ì´ ì‚¬ë‘í•˜ë¼ í•˜ì…¨ìœ¼ë‹ˆ",answers:["ì´ì›ƒ"]},
  {book:"ìš”í•œë³µìŒ",ref:"6:35",before:"ì˜ˆìˆ˜ê»˜ì„œ ì´ë¥´ì‹œë˜ ë‚˜ëŠ” ìƒëª…ì˜",blank:"ë–¡",after:"ì´ë‹ˆ",answers:["ë–¡"]},
  {book:"ìš”í•œê³„ì‹œë¡",ref:"22:13",before:"ë‚˜ëŠ” ì•ŒíŒŒì™€",blank:"ì˜¤ë©”ê°€",after:"ìš” ì²˜ìŒê³¼ ë§ˆì§€ë§‰ì´ìš” ì‹œì‘ê³¼ ëì´ë¼",answers:["ì˜¤ë©”ê°€"]},
  {book:"ì‹œí¸",ref:"119:105",before:"ì£¼ì˜ ë§ì”€ì€ ë‚´ ë°œì—",blank:"ë“±",after:"ì´ìš” ë‚´ ê¸¸ì— ë¹›ì´ë‹ˆì´ë‹¤",answers:["ë“±"]},
  {book:"ìš”í•œë³µìŒ",ref:"11:25",before:"ì˜ˆìˆ˜ê»˜ì„œ ì´ë¥´ì‹œë˜ ë‚˜ëŠ” ë¶€í™œì´ìš”",blank:"ìƒëª…",after:"ì´ë‹ˆ",answers:["ìƒëª…"]},
  {book:"ê°ˆë¼ë””ì•„ì„œ",ref:"5:22",before:"ì˜¤ì§ ì„±ë ¹ì˜",blank:"ì—´ë§¤",after:"ëŠ” ì‚¬ë‘ê³¼ í¬ë½ê³¼ í™”í‰ì´ìš”",answers:["ì—´ë§¤"]},
  {book:"ë§ˆíƒœë³µìŒ",ref:"7:7",before:"êµ¬í•˜ë¼ ê·¸ë¦¬í•˜ë©´ ë„ˆí¬ì—ê²Œ",blank:"ì£¼ì‹¤",after:"ê²ƒì´ìš”",answers:["ì£¼ì‹¤","ì¤€ë‹¤"]},
  {book:"ê³ ë¦°ë„ì „ì„œ",ref:"13:13",before:"ê·¸ëŸ°ì¦‰ ë¯¿ìŒ ì†Œë§",blank:"ì‚¬ë‘",after:"ì´ í•­ìƒ ìˆì„ ê²ƒì¸ë°",answers:["ì‚¬ë‘"]},
  {book:"ë¹Œë¦½ë³´ì„œ",ref:"4:4",before:"ì£¼ ì•ˆì—ì„œ í•­ìƒ",blank:"ê¸°ë»",after:"í•˜ë¼",answers:["ê¸°ë»","ê¸°ë»í•˜ë¼"]},

  // --- 21~40 (ìƒˆë¡œ ì¶”ê°€, ì¤‘ë³µ ì°¸ê³  ì ˆ ì œê±°) ---
  {book:"ìš”í•œë³µìŒ",ref:"3:16",before:"í•˜ë‚˜ë‹˜ì´ ì„¸ìƒì„ ì´ì²˜ëŸ¼ ì‚¬ë‘í•˜ì‚¬",blank:"ë…ìƒì",after:"ë¥¼ ì£¼ì…¨ìœ¼ë‹ˆ",answers:["ë…ìƒì"]},
  {book:"ë§ˆíƒœë³µìŒ",ref:"5:14",before:"ë„ˆí¬ëŠ” ì„¸ìƒì˜",blank:"ë¹›",after:"ì´ë¼",answers:["ë¹›"]},
  {book:"ë§ˆíƒœë³µìŒ",ref:"6:33",before:"ê·¸ëŸ°ì¦‰ ë„ˆí¬ëŠ” ë¨¼ì € ê·¸ì˜ ë‚˜ë¼ì™€ ê·¸ì˜",blank:"ì˜",after:"ë¥¼ êµ¬í•˜ë¼",answers:["ì˜"]},
  {book:"ì¶œì• êµ½ê¸°",ref:"20:12",before:"ë„¤",blank:"ë¶€ëª¨",after:"ë¥¼ ê³µê²½í•˜ë¼",answers:["ë¶€ëª¨"]},
  {book:"ì—ë² ì†Œì„œ",ref:"6:1",before:"ìë…€ë“¤ì•„ ë„ˆí¬",blank:"ë¶€ëª¨",after:"ì—ê²Œ ìˆœì¢…í•˜ë¼",answers:["ë¶€ëª¨"]},
  {book:"ë§ˆê°€ë³µìŒ",ref:"10:14",before:"ì–´ë¦°",blank:"ì•„ì´",after:"ë“¤ì´ ë‚´ê²Œ ì˜¤ëŠ” ê²ƒì„ ìš©ë‚©í•˜ë¼",answers:["ì•„ì´","ì–´ë¦°ì´"]},
  {book:"ìš”í•œì¼ì„œ",ref:"4:19",before:"ìš°ë¦¬ê°€",blank:"ì‚¬ë‘",after:"í•¨ì€ ê·¸ê°€ ë¨¼ì € ìš°ë¦¬ë¥¼ ì‚¬ë‘í•˜ì…¨ìŒì´ë¼",answers:["ì‚¬ë‘"]},
  {book:"ì ì–¸",ref:"3:5",before:"ë„ˆëŠ” ë§ˆìŒì„ ë‹¤í•˜ì—¬ ì—¬í˜¸ì™€ë¥¼",blank:"ì˜ë¢°",after:"í•˜ê³ ",answers:["ì˜ë¢°","ì‹ ë¢°"]},
  {book:"ì ì–¸",ref:"22:6",before:"ë§ˆë•…íˆ í–‰í•  ê¸¸ì„",blank:"ì•„ì´",after:"ì—ê²Œ ê°€ë¥´ì¹˜ë¼",answers:["ì•„ì´"]},
  {book:"ì‹œí¸",ref:"150:6",before:"í˜¸í¡ì´ ìˆëŠ” ìë§ˆë‹¤ ì—¬í˜¸ì™€ë¥¼",blank:"ì°¬ì–‘",after:"í• ì§€ì–´ë‹¤",answers:["ì°¬ì–‘"]},
  {book:"ì‹œí¸",ref:"121:2",before:"ë‚˜ì˜ ë„ì›€ì´ ì²œì§€ë¥¼ ì§€ìœ¼ì‹ ",blank:"ì—¬í˜¸ì™€",after:"ì—ê²Œì„œë¡œë‹¤",answers:["ì—¬í˜¸ì™€"]},
  {book:"ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ",ref:"5:17",before:"ì‰¬ì§€ ë§ê³ ",blank:"ê¸°ë„",after:"í•˜ë¼",answers:["ê¸°ë„"]},
  {book:"ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ",ref:"5:18",before:"ë²”ì‚¬ì—",blank:"ê°ì‚¬",after:"í•˜ë¼",answers:["ê°ì‚¬"]},
  {book:"ìš”í•œê³„ì‹œë¡",ref:"22:20",before:"ì£¼ ì˜ˆìˆ˜ì—¬",blank:"ì˜¤ì‹œì˜µì†Œì„œ",after:"",answers:["ì˜¤ì‹œì˜µì†Œì„œ"]},
  {book:"ìš”í•œë³µìŒ",ref:"8:12",before:"ì˜ˆìˆ˜ê»˜ì„œ ì´ë¥´ì‹œë˜ ë‚˜ëŠ” ì„¸ìƒì˜",blank:"ë¹›",after:"ì´ë‹ˆ",answers:["ë¹›"]},
  {book:"ì‚¬ë„í–‰ì „",ref:"16:31",before:"ì£¼ ì˜ˆìˆ˜ë¥¼",blank:"ë¯¿ìœ¼ë¼",after:" ê·¸ë¦¬í•˜ë©´ ë„ˆì™€ ë„¤ ì§‘ì´ êµ¬ì›ì„ ë°›ìœ¼ë¦¬ë¼",answers:["ë¯¿ìœ¼ë¼","ë¯¿ì–´ë¼"]},
  {book:"ëˆ„ê°€ë³µìŒ",ref:"6:31",before:"ë‚¨ì—ê²Œ ëŒ€ì ‘ì„ ë°›ê³ ì í•˜ëŠ” ëŒ€ë¡œ ë„ˆí¬ë„",blank:"ëŒ€ì ‘",after:"í•˜ë¼",answers:["ëŒ€ì ‘"]},
  {book:"ëˆ„ê°€ë³µìŒ",ref:"19:10",before:"ì¸ìê°€ ì˜¨ ê²ƒì€ ìƒì–´ë²„ë¦° ìë¥¼ ì°¾ì•„",blank:"êµ¬ì›",after:"í•˜ë ¤ í•¨ì´ë‹ˆë¼",answers:["êµ¬ì›"]},
  {book:"ê³ ë¦°ë„ì „ì„œ",ref:"10:31",before:"ë¬´ì—‡ì„ í•˜ë“ ì§€ ë‹¤ í•˜ë‚˜ë‹˜ì˜",blank:"ì˜ê´‘",after:"ì„ ìœ„í•˜ì—¬ í•˜ë¼",answers:["ì˜ê´‘"]},
  {book:"ë¹Œë¦½ë³´ì„œ",ref:"4:6",before:"ì•„ë¬´ ê²ƒë„",blank:"ì—¼ë ¤",after:"í•˜ì§€ ë§ê³ ",answers:["ì—¼ë ¤"]}
);


    // ===== ê²Œì„ ì„¤ì • ìƒìˆ˜ =====
    const TARGET=1000, POINT=50, LIMIT=20, MAX_LIVES=10;

    // ===== ìƒíƒœ ë³€ìˆ˜ =====
    let playerName='ê²ŒìŠ¤íŠ¸',score=0,idx=0,left=LIMIT,order=[],timer=null,currentQ=null,lives=MAX_LIVES,locked=false;

    // ===== ì—˜ë¦¬ë¨¼íŠ¸ ìºì‹œ =====
    const el={
      start:document.getElementById('start'),quiz:document.getElementById('quiz'),leaderboard:document.getElementById('leaderboard'),
      nameInput:document.getElementById('nameInput'),playerBadge:document.getElementById('playerBadge'),score:document.getElementById('score'),
      time:document.getElementById('time'),qIndex:document.getElementById('qIndex'),bar:document.getElementById('bar'),
      verse:document.getElementById('verse'),ref:document.getElementById('ref'),answer:document.getElementById('answer'),
      feedback:document.getElementById('feedback'),lbBody:document.getElementById('lbBody'),lives:document.getElementById('lives'),
      scoreBoard:document.getElementById('scoreBoard')
    };

    // ===== ìœ í‹¸ =====
    function shuffle(array){for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}}
    function norm(s){s=(s||'').toString().toLowerCase();s=s.split(' ').join('');const rm=['[',']','(',')','{','}','\'','.',',',':',';','!','?','Â·','â€¦','â€”','â€“','-','"'];for(let i=0;i<rm.length;i++){s=s.split(rm[i]).join('');}return s;}

    // ===== í™”ë©´ ì „í™˜ =====
    function showStart(){clearInterval(timer);el.start.style.display='grid';el.quiz.style.display='none';el.leaderboard.style.display='none';el.scoreBoard.style.display='none';el.lives.textContent=MAX_LIVES;}
    function showQuiz(){el.start.style.display='none';el.quiz.style.display='block';el.leaderboard.style.display='none';el.scoreBoard.style.display='flex';}
    async function showLeaderboard(){clearInterval(timer);el.start.style.display='none';el.quiz.style.display='none';el.leaderboard.style.display='block';el.scoreBoard.style.display='none';await renderLeaderboard();}

    // ===== ê²Œì„ ë¡œì§ =====
    function startGame(){
      playerName=el.nameInput.value||'ê²ŒìŠ¤íŠ¸';el.playerBadge.textContent=playerName;
      score=0;idx=0;lives=MAX_LIVES;el.lives.textContent=lives;el.score.textContent=score;el.qIndex.textContent=0;
      order=[...Array(QUESTIONS.length).keys()];shuffle(order);showQuiz();nextQuestion();
    }

    function nextQuestion(){
      if(lives<=0){endGame(false);return;}
      if(score>=TARGET){endGame(true);return;}
      if(order.length===0){order=[...Array(QUESTIONS.length).keys()];shuffle(order);} // ë¬´í•œ ëœë¤ ë¡œí…Œì´ì…˜
      currentQ=QUESTIONS[order.shift()];idx++;
      el.qIndex.textContent=idx;el.ref.textContent=`${currentQ.book} ${currentQ.ref}`;
      el.verse.innerHTML=`${currentQ.before} <span class="blank">_____</span> ${currentQ.after}`;
      resetAnswerInput();locked=false;setTimeout(()=>{try{el.answer.focus();}catch(e){}},0);runTimer();
    }

    function runTimer(){left=LIMIT;el.time.textContent=left;el.bar.style.width='100%';clearInterval(timer);timer=setInterval(()=>{left--;el.time.textContent=left;el.bar.style.width=(left/LIMIT*100)+'%';if(left<0){clearInterval(timer);loseLife(`â° ì‹œê°„ì´ˆê³¼! ì •ë‹µ: ${currentQ.blank}`);}},1000);}

    function isCorrectInput(){if(!currentQ)return false;const ans=norm(el.answer.value);const accepts=(currentQ.answers&&currentQ.answers.length?currentQ.answers:[currentQ.blank]).map(norm);return accepts.includes(ans);}    

    function submitAnswer(){if(locked)return;locked=true;const ans=norm(el.answer.value.trim());const accepts=(currentQ.answers&&currentQ.answers.length?currentQ.answers:[currentQ.blank]).map(norm);if(accepts.includes(ans)){score+=POINT;el.score.textContent=score;feedback(true,'ì •ë‹µ!');setTimeout(nextQuestion,650);}else{loseLife('ì˜¤ë‹µ! ì •ë‹µ: '+currentQ.blank);}}

    function loseLife(msg){locked=true;lives--;el.lives.textContent=lives;feedback(false,msg);if(lives<=0){endGame(false);}else{setTimeout(nextQuestion,800);}}

    function feedback(ok,msg){el.feedback.style.display='block';el.feedback.textContent=msg;el.feedback.className='result '+(ok?'good':'bad');}

    // ì…ë ¥ì¹¸ì„ í•­ìƒ ìƒˆë¡œ ìƒì„±í•˜ì—¬ ì´ì „ ê°’ ì”ì¡´ ì œê±°
    function resetAnswerInput(){const old=document.getElementById('answer');const fresh=old.cloneNode(false);fresh.id='answer';fresh.className=old.className;fresh.type='text';fresh.placeholder=old.placeholder;fresh.autocomplete='off';fresh.autocapitalize='off';fresh.autocorrect='off';fresh.spellcheck=false;fresh.inputMode='text';old.parentNode.replaceChild(fresh,old);el.answer=fresh;el.answer.value='';attachAnswerListeners();}

    function attachAnswerListeners(){el.answer.addEventListener('keydown',e=>{if(e.key==='Enter'){submitAnswer();}});el.answer.addEventListener('input',()=>{if(!locked&&isCorrectInput()){submitAnswer();}});}    

    // ===== ë­í‚¹ ì €ì¥/ì¡°íšŒ (Firebase) =====
    async function endGame(success=true){
      if(success && lives>0){
        const now=new Date();
        const finished= now.getFullYear()+"-"+String(now.getMonth()+1).padStart(2,'0')+"-"+String(now.getDate()).padStart(2,'0')+" "+now.toLocaleTimeString();
        try{await recordsCol.add({name:playerName||'ê²ŒìŠ¤íŠ¸',score:score,time:finished,createdAt:firebase.firestore.FieldValue.serverTimestamp()});}
        catch(e){console.error('saveRecord failed:',e);alert('ê¸°ë¡ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš” ğŸ˜­');}
      }
      showLeaderboard();
    }

    async function renderLeaderboard(){
      try{
        const snap=await recordsCol.orderBy('score','desc').orderBy('createdAt','asc').limit(100).get();
        const rows=[];let rank=1;snap.forEach(doc=>{const r=doc.data();rows.push(`<tr><td>${rank++}</td><td>${(r.name||'')}</td><td>${(r.score||0)}</td><td>${(r.time||'')}</td></tr>`);});
        el.lbBody.innerHTML=rows.join('')||`<tr><td colspan="4">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
      }catch(e){console.error(e);el.lbBody.innerHTML=`<tr><td colspan="4">ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”.</td></tr>`;}
    }

    // ===== ì´ë²¤íŠ¸ ë°”ì¸ë”© =====
    document.getElementById('startBtn').onclick=startGame;
    document.getElementById('submitBtn').onclick=submitAnswer;
    document.getElementById('passBtn').onclick=()=>{loseLife('íŒ¨ìŠ¤! ì •ë‹µ: '+currentQ.blank)};
    document.getElementById('rankBtn').onclick=showLeaderboard;
    document.getElementById('backStart').onclick=showStart;

    // ìš´ì˜ì: Firestore ë­í‚¹ ì´ˆê¸°í™”
    document.getElementById('adminBtn').onclick=async()=>{
      const pw=prompt('ë¹„ë°€ë²ˆí˜¸ ì…ë ¥');
      if(pw!=='eckc3004'){alert('ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜');return;}
      if(!confirm('ì •ë§ ë­í‚¹ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë˜ëŒë¦´ ìˆ˜ ì—†ìŒ)')) return;
      try{const snap=await recordsCol.get();const jobs=[];snap.forEach(d=>jobs.push(d.ref.delete()));await Promise.all(jobs);alert('ë­í‚¹ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');renderLeaderboard();}
      catch(e){console.error(e);alert('ì´ˆê¸°í™” ì‹¤íŒ¨. ì½˜ì†”ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.');}
    };

    // ì´ˆê¸°í™”
    attachAnswerListeners();
    showStart();
  </script>
</body>
</html>
